#!/usr/bin/env ruby
require 'yaml'
require 'cli'
require 'trello'
require 'kanboard'
require 'kanboard/csv'
require 'table_print'
require 'byebug'

command = ARGV[0]
@config = YAML::load_file('config/trello2kanboard.yml')
@kanboard = Kanboard::Client.new


Trello.configure do |config|
  config.developer_public_key = @config['trello']['developer_public_key']
  config.member_token = @config['trello']['member_token']
end

if command 
  # Lists existing Trello boards/Kanboard projects via API
  if command == 'list'
    list_trello_boards
    list_kanboard_projects

  # Imports cards from Trello to Kanboard via API
  elsif command == 'import'
    source_board_id = ARGV[1]
    target_project_id = ARGV[2]
    if source_board_id && target_project_id
      #byebug
      @kanboard.import_board(source_board_id, target_project_id)
    else
      puts "Set source board ID and target project ID, please: import f00b4r 5"
    end

  # Converts a CSV file from Trello format to Kanboard format
  elsif command == 'convert'
    filename = ARGV[1]
    convert_csv_to_kanboard(filename, '/tmp/kanboard.csv')
  end
else
  puts "Please supply a command: import, list"
  exit
end
